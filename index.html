<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Soccer Predictor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{--accent:#00ffff;--bg:#065565;--text:#fff;--card-bg:rgba(0,0,0,.6);--cookie-bg:rgba(0,0,0,.85)}
body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text);border:2px solid var(--accent);min-height:100vh;overflow-x:hidden;position:relative}
.hidden{display:none}
p{text-align:center;margin-top:70px;margin-bottom:10px}
.sidenav{height:100%;width:0;position:fixed;z-index:1;top:0;left:0;background-color:#065565;overflow-x:hidden;transition:.5s;padding-top:60px}
.sidenav a{padding:8px 8px 8px 28px;text-decoration:none;font-size:25px;color:#fff;display:block;transition:.3s}
.sidenav a:hover{color:#f85356}
.sidenav .closebtn{position:absolute;top:0;right:48px;font-size:36px;margin-left:50px}
.header-bar{position:fixed;top:0;left:0;right:0;margin:auto;text-align:center;background:#000;color:var(--accent);padding:12px;font-size:28px;cursor:pointer;z-index:9999}
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}
#bottom-alert{font-weight:700;font-size:16px;animation:blink 1.8s linear infinite;color:#fff}
@keyframes blink{0%,50%,100%{opacity:1}25%,75%{opacity:.25}}
.spinner{width:40px;height:40px;border:5px solid rgba(255,255,255,.3);border-top:5px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:12px}
@keyframes spin{to{transform:rotate(360deg)}}
#offline-overlay{position:fixed;inset:0;background:#000;color:#f55;font-size:22px;font-weight:700;text-align:center;justify-content:center;align-items:center;z-index:10001;display:none}
.main{padding:10px 12px 50px}
.card{background:var(--card-bg);border-radius:12px;padding:12px;margin-bottom:16px;box-shadow:0 0 12px rgba(0,0,0,.7)}
.card-header{display:flex;justify-content:space-between;font-weight:700;margin-bottom:8px}
.card-header small{color:#ccc}
.day-title{color:var(--accent);text-align:center;font-size:20px;font-weight:700;margin:10px 0 12px}
.footer{position:fixed;bottom:0;left:0;right:0;text-align:center;background:#000;color:var(--accent);padding:8px 0;border-top:2px solid var(--accent);z-index:1000}
#cookie-banner{position:fixed;bottom:0;left:0;right:0;background:var(--cookie-bg);color:#fff;padding:12px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;font-size:14px;border-top:2px solid var(--accent);z-index:11000}
#cookie-banner span{flex:1 1 220px;margin-bottom:6px}
#cookie-banner button{background:var(--accent);color:#000;border:none;border-radius:6px;padding:8px 14px;font-weight:700;cursor:pointer}
canvas{max-width:100%}
input[type=date]{padding:4px 6px;border-radius:4px;border:1px solid var(--accent);background:#000;color:var(--accent)}
.pred-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;margin-top:6px;font-size:11px;text-align:center}
.pred-grid div{padding:3px 2px;border-radius:4px;background:rgba(0,0,0,0.35)}
.pred-grid .pred-label{font-weight:bold;color:#00ffff}
.pred-grid .pred-value{font-weight:bold;color:#fff}
.chart-scroll{overflow-x:auto;padding-bottom:4px;margin-top:6px}
.chart-scroll-inner{min-width:520px}
@media(max-width:480px){.chart-scroll-inner{min-width:420px}}
.cop-box,.h2h-box{margin-top:12px;padding:12px;border-radius:12px;background:rgba(0,0,0,0.55);border:1px solid #00ffff55;font-size:12px;line-height:1.45;box-shadow:0 0 10px rgba(0,255,255,0.15);position:relative}
.cop-title,.h2h-title{font-weight:700;color:#00ffff;margin-bottom:8px;text-align:center;font-size:14px;letter-spacing:.6px;display:flex;justify-content:center;align-items:center;gap:6px}
.cop-row{display:flex;justify-content:space-between;gap:10px}
.cop-team{flex:1;background:rgba(0,0,0,0.25);padding:10px;border-radius:10px;border:1px solid #00ffff33;text-align:center}
.cop-team.highlight{border-color:#ffd700cc;box-shadow:0 0 12px rgba(255,215,0,0.35);transform:scale(1.03);background:rgba(255,215,0,0.08)}
.cop-badge,.h2h-badge{position:absolute;top:-10px;background:#ffd700;color:#000;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;box-shadow:0 0 8px rgba(255,215,0,0.5)}
.cop-badge{right:-10px}
.h2h-badge{left:-10px}
.h2h-stats{text-align:center;margin-top:6px;color:#fff}
.h2h-pred,.cop-pred{margin-top:10px;text-align:center;font-weight:700;color:#ffd700;font-size:15px;letter-spacing:.7px}
</style>
</head>

<body>

<div id="overlay">
  <div class="spinner"></div>
  <div id="bottom-alert">WAIT, DATA IS LOADING...</div>
</div>

<div id="offline-overlay">OFFLINE</div>

<div id="cookie-banner" class="hidden">
  <span>This site uses cookies to improve your experience.</span>
  <button id="cookieAccept">OK</button>
</div>

<div id="deferred-root" class="hidden">

  <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a href="#">WhatsApp</a>
    <a href="#">Email</a>
    <a href="#">Facebook</a>
    <a href="#">YouTube</a>
  </div>

  <div id="headerBar" class="header-bar" onclick="openNav()">
    &#9776;&nbsp;<b>SOCCER PREDICTOR</b>
  </div>

  <p>Select matches by date <input type="date" id="date-selector"></p>

  <div id="day-title" class="day-title"></div>

  <main class="main" id="content"></main>

</div>

<div class="footer">&copy;2025 cl@udiuz</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<script>
const overlay=document.getElementById("overlay");
const bottomAlert=document.getElementById("bottom-alert");
const offlineOverlay=document.getElementById("offline-overlay");
const deferredRoot=document.getElementById("deferred-root");
const content=document.getElementById("content");
const dateSelector=document.getElementById("date-selector");
const cookieBanner=document.getElementById("cookie-banner");
const cookieBtn=document.getElementById("cookieAccept");
const dayTitle=document.getElementById("day-title");

let activeRequestId=0;

/* SIDENAV */
function openNav(){
  document.getElementById("mySidenav").style.width="100%";
  document.getElementById("headerBar").style.display="none";
}
function closeNav(){
  document.getElementById("mySidenav").style.width="0";
  document.getElementById("headerBar").style.display="block";
}

/* COOKIE */
cookieBtn.onclick=()=>{
  localStorage.setItem("cookieNoticeAccepted","true");
  cookieBanner.classList.add("hidden");
};

/* OFFLINE */
function showOffline(){
  overlay.style.display="flex";
  bottomAlert.textContent="OFFLINE...";
  deferredRoot.classList.add("hidden");
  offlineOverlay.style.display="flex";
}

/* REVEAL */
function reveal(id){
  if(id!==activeRequestId)return;
  overlay.style.display="none";
  offlineOverlay.style.display="none";
  deferredRoot.classList.remove("hidden");
}

/* RENDER MATCHES ‚Äî TOT CODUL TƒÇU COMPLET */
function renderPredictions(list){
  content.innerHTML="";
  list.forEach((item,index)=>{
    const home=item.predictions.home;
    const draw=item.predictions.draw;
    const away=item.predictions.away;
    const btts=item.predictions.btts;
    const over15=item.predictions.over15;

    const card=document.createElement("div");
    card.className="card";

    let copHTML="";
    if(item.COP){
      const t1=item.COP.team1;
      const t2=item.COP.team2;
      const t1Class=t1.points>t2.points?"highlight":"";
      const t2Class=t2.points>t1.points?"highlight":"";
      copHTML=`
      <div class="cop-box">
        <div class="cop-badge">${item.COP.prediction}</div>
        <div class="cop-title"><span class="icon">‚öñÔ∏è</span>COP ‚Äì Common Opponents Predictor</div>
        <div class="cop-row">
          <div class="cop-team ${t1Class}"><b>Team 1</b><br>${t1.points}p (${t1.wins}W ${t1.draws}D ${t1.losses}L)</div>
          <div class="cop-team ${t2Class}"><b>Team 2</b><br>${t2.points}p (${t2.wins}W ${t2.draws}D ${t2.losses}L)</div>
        </div>
        <div class="cop-pred">Prediction: ${item.COP.prediction}</div>
      </div>`;
    }

    let h2hHTML="";
    if(item.H2H && item.H2H.matches>0){
      h2hHTML=`
      <div class="h2h-box">
        <div class="h2h-badge">${item.H2H.prediction}</div>
        <div class="h2h-title"><span class="icon">üîÅ</span>H2H ‚Äì Last ${item.H2H.matches} Meetings</div>
        <div class="h2h-stats">${item.H2H.wins}W ${item.H2H.draws}D ${item.H2H.losses}L<br>
        Goals: ${item.H2H.goalsFor}-${item.H2H.goalsAgainst}<br>
        Points: ${item.H2H.points}</div>
        <div class="h2h-pred">Prediction: ${item.H2H.prediction}</div>
      </div>`;
    }

    card.innerHTML=`
      <div class="card-header">
        <div>${item.match}<br><small>Date: ${item.date}</small></div>
        <div>Pred: ${item.predictions.final}</div>
      </div>

      <canvas id="chart-${index}" height="150"></canvas>

      <div class="pred-grid">
        <div class="pred-label">1</div><div class="pred-label">X</div><div class="pred-label">2</div>
        <div class="pred-label">BTTS</div><div class="pred-label">+1.5</div>
        <div class="pred-value">${home}%</div>
        <div class="pred-value">${draw}%</div>
        <div class="pred-value">${away}%</div>
        <div class="pred-value">${btts}%</div>
        <div class="pred-value">${over15}%</div>
      </div>

      <div class="chart-scroll"><div class="chart-scroll-inner">
        <canvas id="formchart-${index}" height="140"></canvas>
      </div></div>

      ${copHTML}${h2hHTML}
    `;

    content.appendChild(card);

    /* BAR CHART */
    const ctx=document.getElementById(`chart-${index}`).getContext("2d");
    new Chart(ctx,{
      type:"bar",
      data:{
        labels:["1","2","BTTS"],
        datasets:[{
          label:"Prediction",
          data:[home,away,btts],
          backgroundColor:["rgba(0,255,255,0.8)","rgba(255,215,0,0.8)","rgba(255,80,80,0.8)"],
          borderColor:["#00ffff","#ffd700","#ff4c4c"],
          borderWidth:2,
          barThickness:26
        }]
      },
      options:{
        responsive:true,
        animation:false,
        plugins:{
          legend:{display:false},
          datalabels:{
            color:"#fff",
            font:{weight:"bold",size:11},
            anchor:"end",
            align:"start",
            formatter:v=>v+"%",
            textStrokeColor:"#000",
            textStrokeWidth:3
          }
        },
        scales:{
          y:{beginAtZero:true,max:100,ticks:{color:"#fff"}},
          x:{ticks:{color:"#fff"}}
        }
      },
      plugins:[ChartDataLabels]
    });

    /* FORM CHART */
    const fc=item.formChart;
    if(fc){
      const ctxForm=document.getElementById(`formchart-${index}`).getContext("2d");
      const t1=fc.team1,t2=fc.team2;
      const maxLen=Math.max(t1.length,t2.length);
      const labels=[],data1=new Array(maxLen).fill(null),data2=new Array(maxLen).fill(null);
      for(let i=0;i<maxLen;i++)labels.push("M"+(i+1));
      for(let i=0;i<t1.length;i++)data1[i]=t1[i].pts;
      for(let i=0;i<t2.length;i++)data2[i]=t2[i].pts;

      new Chart(ctxForm,{
        type:"line",
        data:{
          labels:labels,
          datasets:[
            {label:fc.team1Name,data:data1,borderColor:"#22c55e",backgroundColor:"rgba(34,197,94,0.15)",tension:0.3,pointRadius:4},
            {label:fc.team2Name,data:data2,borderColor:"#ef4444",backgroundColor:"rgba(239,68,68,0.15)",tension:0.3,pointRadius:4}
          ]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{legend:{labels:{color:"#fff",font:{size:10}}}},
          scales:{
            x:{ticks:{color:"#9ca3af",font:{size:9}},grid:{color:"#111827"}},
            y:{ticks:{color:"#9ca3af",font:{size:9}},grid:{color:"#111827"},suggestedMin:0,suggestedMax:3,stepSize:1}
          }
        }
      });
    }
  });
}

/* FETCH JSON ‚Äî DOAR DATA SELECTATƒÇ, FƒÇRƒÇ FALBACK */
async function fetchJSON(date=null){
  const id=++activeRequestId;

  overlay.style.display="flex";
  bottomAlert.textContent="WAIT, DATA IS LOADING...";

  try{
    if(!date){
      date=new Date().toISOString().slice(0,10);
    }

    dateSelector.value=date;
    dayTitle.textContent=new Date(date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});

    const response=await fetch(`data/${date}.json`,{cache:"no-store"});

    if(response.status===404){
      content.innerHTML="<p>- NO DATA!</p>";
      reveal(id);
      return;
    }

    if(!response.ok){
      content.innerHTML="<p>- NO DATA!</p>";
      reveal(id);
      return;
    }

    let arr;
    try{arr=await response.json();}catch{
      content.innerHTML="<p>- INVALID JSON!</p>";
      reveal(id);
      return;
    }

    let list=[];
    if(Array.isArray(arr))list=arr;
    else if(arr && typeof arr==="object")list=[arr];

    if(list.length===0){
      content.innerHTML="<p>- NO DATA!</p>";
      reveal(id);
      return;
    }

    renderPredictions(list);
    reveal(id);

    if(navigator.onLine && !localStorage.getItem("cookieNoticeAccepted")){
      cookieBanner.classList.remove("hidden");
    }

  }catch{
    if(!navigator.onLine){showOffline();return;}
    content.innerHTML="<p>- NO DATA!</p>";
    reveal(id);
  }
}

/* SELECTOR ‚Äî PERMITE ORICE DATƒÇ */
dateSelector.addEventListener("input",e=>{
  const d=e.target.value;
  if(!d)return;
  fetchJSON(d);
});

/* INIT ‚Äî √éNCARCƒÇ DOAR DATA CURENTƒÇ */
window.addEventListener("load",()=>{
  setTimeout(()=>{
    if(!navigator.onLine){
      showOffline();
      return;
    }

    const today=new Date().toISOString().slice(0,10);

    dateSelector.setAttribute("value",today);
    dateSelector.value=today;

    fetchJSON(today);

  },0);
});
</script>
</body>
</html>
