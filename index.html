<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Soccer Predictor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{--accent:#00ffff;--bg:#065565;--text:#fff;--card-bg:rgba(0,0,0,.6);--cookie-bg:rgba(0,0,0,.85);--win:#22c55e;--loss:#ef4444}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Arial,sans-serif;background:var(--bg);color:var(--text);border:2px solid var(--accent);min-height:100vh;overflow-x:hidden;position:relative}
.hidden{display:none}
.header-bar{position:fixed;top:0;left:0;right:0;margin:auto;text-align:center;background:#000;color:var(--accent);padding:12px;font-size:28px;cursor:pointer;z-index:9999}
.sidenav{height:100%;width:0;position:fixed;z-index:1;top:0;left:0;background:#065565;overflow-x:hidden;transition:.5s;padding-top:60px}
.sidenav a{padding:8px 8px 8px 28px;text-decoration:none;font-size:25px;color:#fff;display:block;transition:.3s}
.sidenav a:hover{color:#f85356}
.sidenav .closebtn{position:absolute;top:0;right:48px;font-size:36px}
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}
.spinner{width:40px;height:40px;border:5px solid rgba(255,255,255,.3);border-top:5px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#offline-overlay{position:fixed;inset:0;background:#000;color:#f55;font-size:22px;font-weight:700;text-align:center;justify-content:center;align-items:center;z-index:10001;display:none}
p{text-align:center;margin-top:70px;margin-bottom:10px}
.main{padding:10px 12px 50px}
.day-title{color:var(--accent);text-align:center;font-size:20px;font-weight:700;margin:10px 0 12px}
.card{background:var(--card-bg);border-radius:12px;padding:12px;margin-bottom:16px;box-shadow:0 0 12px rgba(0,0,0,.7)}
.card-header{display:flex;justify-content:space-between;font-weight:700;margin-bottom:8px}
.card-header small{color:#ccc}
.pred-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;margin-top:10px;font-size:13px;text-align:center}
.pred-cell{padding:10px 6px;border-radius:10px;font-weight:900;font-family:"Arial Black",Arial,sans-serif;color:#fff;box-shadow:0 0 6px rgba(0,0,0,.4);transition:transform .15s}
.pred-cell:hover{transform:scale(1.05)}
.pred-label{font-size:11px;opacity:.85;margin-bottom:3px}
canvas{max-width:100%}
.chart-scroll{overflow-x:auto;padding-bottom:4px;margin-top:6px}
.chart-scroll-inner{min-width:320px;max-width:100%}
.cop-box,.h2h-box{margin-top:12px;padding:12px;border-radius:12px;background:rgba(0,0,0,.55);border:1px solid #00ffff55;font-size:12px;line-height:1.45;box-shadow:0 0 10px rgba(0,255,255,.15);position:relative;cursor:pointer}
.cop-title,.h2h-title{font-weight:700;color:#00ffff;margin-bottom:8px;text-align:center;font-size:14px;letter-spacing:.6px;display:flex;justify-content:center;align-items:center;gap:6px}
.cop-row{display:flex;justify-content:space-between;gap:10px}
.cop-team{flex:1;background:rgba(0,0,0,.25);padding:10px;border-radius:10px;border:1px solid #00ffff33;text-align:center}
.cop-team.highlight{border-color:#ffd700cc;box-shadow:0 0 12px rgba(255,215,0,.35);transform:scale(1.03);background:rgba(255,215,0,.08)}
.cop-badge,.h2h-badge{position:absolute;top:-10px;background:#ffd700;color:#000;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;box-shadow:0 0 8px rgba(255,215,0,.5)}
.cop-badge{right:-10px}
.h2h-badge{left:-10px}
.h2h-stats{text-align:center;margin-top:6px;color:#fff}
.h2h-pred,.cop-pred{margin-top:10px;text-align:center;font-weight:700;color:#ffd700;font-size:15px;letter-spacing:.7px}
.h2h-box.disabled{opacity:.6;cursor:default}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;justify-content:center;align-items:center;z-index:12000}
.modal-card{background:#0b1519;border-radius:14px;border:2px solid #00ffff55;box-shadow:0 0 20px rgba(0,0,0,.8);max-width:90%;width:640px;max-height:80vh;padding:14px 16px 16px;display:flex;flex-direction:column}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.modal-title{font-weight:700;color:var(--accent);font-size:16px}
.modal-close{cursor:pointer;color:#ff4b4b;font-size:20px;font-weight:900}
.modal-close:hover{color:#ff7777}
.modal-body{overflow:auto}
.modal-table{width:100%;border-collapse:collapse;color:#fff;font-size:13px}
.modal-table th,.modal-table td{padding:6px 8px;border:2px solid #1f2e35;text-align:center}
.modal-table th{background:#0b1519;color:gold;font-size:12px}
.modal-table tr:nth-child(even) td{background:#162229}
.modal-table tr:nth-child(odd) td{background:#111b22}
.small-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;justify-content:center;align-items:center;z-index:12500}
.small-modal-card{background:#162229;border-radius:14px;border:2px solid #00ffff55;box-shadow:0 0 18px rgba(0,0,0,.85);max-width:320px;width:90%;padding:10px 12px 12px;position:relative}
.small-modal-close{position:absolute;top:6px;right:8px;cursor:pointer;color:#ff4b4b;font-size:18px;font-weight:900}
.small-modal-close:hover{color:#ff7777}
.small-modal-body{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px}
.small-match-block{flex:1 1 130px;background:#0b1519;border-radius:10px;padding:6px 8px;border:1px solid #1f2e35;font-size:12px}
.small-match-header{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.small-dot{width:10px;height:10px;border-radius:50%}
.small-date{font-size:11px;color:#ccc}
.small-score{font-weight:700;color:gold;margin-top:2px}
.small-ha{font-size:11px;font-weight:700}
.small-opponent{font-size:12px}
@keyframes pulsePoint{0%{transform:scale(1);box-shadow:0 0 0 rgba(255,255,255,0)}50%{transform:scale(1.4);box-shadow:0 0 10px rgba(255,255,255,.7)}100%{transform:scale(1);box-shadow:0 0 0 rgba(255,255,255,0)}}
#cookie-banner{position:fixed;bottom:0;left:0;right:0;background:var(--cookie-bg);color:#fff;padding:12px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;font-size:14px;border-top:2px solid var(--accent);z-index:11000}
#cookie-banner span{flex:1 1 220px;margin-bottom:6px}
#cookie-banner button{background:var(--accent);color:#000;border:none;border-radius:6px;padding:8px 14px;font-weight:700;cursor:pointer}
.footer{position:fixed;bottom:0;left:0;right:0;text-align:center;background:#000;color:var(--accent);padding:8px 0;border-top:2px solid var(--accent);z-index:1000}
@media(max-width:600px){.card-header{flex-direction:column;gap:4px}.cop-row{flex-direction:column}}
</style>
</head>

<body>

<div id="overlay"><div class="spinner"></div></div>
<div id="offline-overlay">OFFLINE</div>

<div id="cookie-banner" class="hidden">
  <span>Acest site folosește cookie-uri pentru a îmbunătăți experiența.</span>
  <button id="cookieAccept">OK</button>
</div>

<div id="bigModal" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-header">
      <div id="bigModalTitle" class="modal-title"></div>
      <div id="bigModalClose" class="modal-close">✖</div>
    </div>
    <div id="bigModalBody" class="modal-body"></div>
  </div>
</div>

<div id="smallModal" class="small-modal-overlay">
  <div class="small-modal-card">
    <div id="smallModalClose" class="small-modal-close">✖</div>
    <div id="smallModalBody" class="small-modal-body"></div>
  </div>
</div>

<div id="deferred-root" class="hidden">
  <div id="mySidenav" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a href="#">WhatsApp</a>
    <a href="#">Email</a>
    <a href="#">Facebook</a>
    <a href="#">YouTube</a>
  </div>

  <div id="headerBar" class="header-bar" onclick="openNav()">
    &#9776;&nbsp;<b>SOCCER PREDICTOR</b>
  </div>

  <p>Selectează meciurile după dată <input type="date" id="date-selector"></p>
  <div id="day-title" class="day-title"></div>
  <main class="main" id="content"></main>
</div>

<div class="footer">&copy;2025 cl@udiuz</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ================== ELEMENTE ================== */
const overlay = document.getElementById("overlay");
const offlineOverlay = document.getElementById("offline-overlay");
const deferredRoot = document.getElementById("deferred-root");
const content = document.getElementById("content");
const dateSelector = document.getElementById("date-selector");
const cookieBanner = document.getElementById("cookie-banner");
const cookieBtn = document.getElementById("cookieAccept");
const dayTitle = document.getElementById("day-title");

const bigModal = document.getElementById("bigModal");
const bigModalTitle = document.getElementById("bigModalTitle");
const bigModalBody = document.getElementById("bigModalBody");
const bigModalClose = document.getElementById("bigModalClose");

const smallModal = document.getElementById("smallModal");
const smallModalBody = document.getElementById("smallModalBody");
const smallModalClose = document.getElementById("smallModalClose");

let charts = [];
let activeRequestId = 0;
let controller = null;

/* ================== UTILS ================== */
const esc = s => String(s ?? "").replace(/[&<>"']/g,m=>({
  "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
}[m]));

function num(v){
  v = Number(v);
  return isNaN(v) ? 0 : v;
}

function formatEuroDate(iso){
  if(!iso) return "";
  const d = new Date(iso);
  if(isNaN(d.getTime())) return "";
  return d.toLocaleDateString("ro-RO",{day:"2-digit",month:"2-digit",year:"numeric"});
}

/* ================== UI STATE ================== */
function showOffline(){
  overlay.style.display="none";
  deferredRoot.classList.add("hidden");
  offlineOverlay.style.display="flex";
  cookieBanner.classList.add("hidden");
}

function reveal(id){
  if(id !== activeRequestId) return;

  overlay.style.display="none";
  offlineOverlay.style.display="none";
  deferredRoot.classList.remove("hidden");

  if(localStorage.getItem("cookieNoticeAccepted") !== "true"){
    cookieBanner.classList.remove("hidden");
  }
}

/* ================== COOKIE ================== */
if(cookieBtn){
  cookieBtn.onclick = ()=>{
    localStorage.setItem("cookieNoticeAccepted","true");
    cookieBanner.classList.add("hidden");
  };
}

/* ================== SIDENAV ================== */
function openNav(){
  document.getElementById("mySidenav").style.width="100%";
  document.getElementById("headerBar").style.display="none";
}
function closeNav(){
  document.getElementById("mySidenav").style.width="0";
  document.getElementById("headerBar").style.display="block";
}

/* ================== CELULE ================== */
function makeCell(label,value){
  value = num(value);
  let bg="#444";
  if(value>=75) bg="#00c853";
  else if(value>=60) bg="#ffd600";
  else if(value>=40) bg="#ff9100";
  else bg="#d50000";

  return `<div class="pred-cell" style="background:${bg}">
    <div class="pred-label">${label}</div>${value}%
  </div>`;
}

/* ================== MODALE ================== */
function openBigModal(title,html){
  bigModalTitle.textContent = title;
  bigModalBody.innerHTML = html;
  bigModal.style.display="flex";
}
function closeBigModal(){ bigModal.style.display="none"; }

function openSmallModal(blocks){
  smallModalBody.textContent="";
  blocks.forEach(b=>{
    const div=document.createElement("div");
    div.className="small-match-block";
    div.innerHTML=`
      <div class="small-match-header">
        <div class="small-dot" style="background:${b.color}"></div>
        <div class="small-date">${b.date}</div>
      </div>
      <div class="small-opponent">${esc(b.opponent)}</div>
      <div class="small-ha" style="color:${b.haColor}">${b.ha}</div>
      <div class="small-score">${esc(b.score)}</div>
    `;
    smallModalBody.appendChild(div);
  });
  smallModal.style.display="flex";
}
function closeSmallModal(){ smallModal.style.display="none"; }

bigModalClose.onclick = closeBigModal;
smallModalClose.onclick = closeSmallModal;

document.addEventListener("keydown",e=>{
  if(e.key==="Escape"){
    closeBigModal();
    closeSmallModal();
  }
});

/* ================== RENDER ================== */
function renderPredictions(list){
  content.innerHTML="";
  charts.forEach(c=>c.destroy());
  charts=[];

  list.forEach((item,index)=>{
    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <div class="card-header">
        <div>${esc(item.match)}<br>
          <small>Data: ${formatEuroDate(item.date)}</small>
        </div>
        <div>Pred: ${esc(item.predictions?.final)}</div>
      </div>

      <div class="pred-grid">
        ${makeCell("1",item.predictions?.home)}
        ${makeCell("X",item.predictions?.draw)}
        ${makeCell("2",item.predictions?.away)}
        ${makeCell("BTTS",item.predictions?.btts)}
        ${makeCell("+1.5",item.predictions?.over15)}
      </div>

      <div class="chart-scroll">
        <div class="chart-scroll-inner">
          <canvas id="chart-${index}" height="110"></canvas>
        </div>
      </div>
    `;

    content.appendChild(card);

    if(item.formChart){
      const ctx=document.getElementById(`chart-${index}`).getContext("2d");
      const t1=item.formChart.team1||[];
      const t2=item.formChart.team2||[];

      const max=Math.max(t1.length,t2.length);
      const labels=[...Array(max)].map((_,i)=>"M"+(i+1));
      const d1=[...Array(max)].map((_,i)=>t1[i]?.pts ?? null);
      const d2=[...Array(max)].map((_,i)=>t2[i]?.pts ?? null);

      const chart=new Chart(ctx,{
        type:"line",
        data:{
          labels,
          datasets:[
            {label:item.formChart.team1Name,data:d1,borderColor:"#22c55e",tension:.3},
            {label:item.formChart.team2Name,data:d2,borderColor:"#ef4444",tension:.3}
          ]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false
        }
      });
      charts.push(chart);
    }
  });
}

/* ================== FETCH ================== */
async function fetchJSON(date){
  if(controller) controller.abort();
  controller = new AbortController();

  const id=++activeRequestId;
  overlay.style.display="flex";

  try{
    const res = await fetch(`data/${date}.json`,{
      cache:"no-store",
      signal: controller.signal
    });

    dayTitle.textContent = formatEuroDate(date);

    if(!res.ok){
      charts.forEach(c=>c.destroy());
      charts=[];
      content.innerHTML="<p>- NO DATA!</p>";
      reveal(id);
      return;
    }

    let data;
    try{
      data = await res.json();
    }catch{
      content.innerHTML="<p>- INVALID DATA</p>";
      reveal(id);
      return;
    }

    const list = Array.isArray(data) ? data : [data];
    if(!list.length){
      content.innerHTML="<p>- NO DATA!</p>";
      reveal(id);
      return;
    }

    renderPredictions(list);
    reveal(id);

  }catch(e){
    if(e.name!=="AbortError") showOffline();
  }
}

/* ================== INIT ================== */
window.addEventListener("load",()=>{
  const today=new Date().toISOString().slice(0,10);
  fetchJSON(today);
});

if(dateSelector){
  dateSelector.addEventListener("change",e=>{
    if(e.target.value) fetchJSON(e.target.value);
  });
}
</script>

</body>
</html>

